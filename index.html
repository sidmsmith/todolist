<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>To Do List v0.0.1</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    :root {
      --bg-dark: #121212;
      --card-bg: #1e1e1e;
      --input-bg: #2d2d2d;
      --border: #333;
      --text: #e0e0e0;
      --red-text: #ff6b6b;
      --blue-select: #339af0;
      --success: #28a745;
      --primary: #0d6efd;
      --orange: #e67700;
      --purple: #9c27b0;
    }

    body { 
      background: var(--bg-dark); 
      color: var(--text); 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      min-height: 100vh;
      margin: 0;
      padding-bottom: 2rem;
    }

    .main-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      padding: 1.5rem;
      margin: 1rem;
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 769px) {
      .main-card { max-width: 1200px; margin: 2rem auto; }
    }

    .form-control, .form-select, textarea {
      background: var(--input-bg);
      border: 1px solid #444;
      color: #fff;
      border-radius: 8px;
    }
    .form-control:focus, .form-select:focus, textarea:focus {
      background: #333;
      border-color: var(--primary);
      box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
      color: #fff;
    }

    .btn-primary { background: var(--primary); border: none; }
    .btn-success { background: var(--success); border: none; }
    .btn-secondary { background: #6c757d; border: none; }
    .btn-danger { background: #dc3545; border: none; color: white; }
    .btn-orange { background: var(--orange); border: none; color: white; }
    .btn-blue { background: #1e90ff; border: none; }
    .btn-purple { background: var(--purple); border: none; }
    .btn-primary:hover { background: #0b5ed7; }
    .btn-success:hover { background: #218838; }
    .btn-danger:hover { background: #c82333; }
    .btn-orange:hover { background: #c65f00; }
    .btn-blue:hover { background: #1c7ed6; }
    .btn-purple:hover { background: #7b1fa2; }

    .section-frame {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background: var(--card-bg);
      width: 100%;
      box-sizing: border-box;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .form-label { color: #bbbbbb; font-weight: 600; font-size: 0.9em; }
    small { color: #999; font-size: 0.85em; }
    h2 { color: var(--primary); text-align: center; margin-bottom: 1.5rem; }
    
    /* Gallery View Styles */
    .gallery-item {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
      border-radius: 8px;
      background: var(--input-bg);
      border: 2px solid transparent;
      transition: all 0.3s ease;
      cursor: pointer;
      width: 100%;
      min-width: 0;
      overflow: hidden;
    }
    
    .gallery-item.selected {
      border-color: #00ffff;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.6), 0 0 30px rgba(0, 255, 255, 0.4);
    }
    
    .gallery-item:hover {
      background: #333;
      transform: translateY(-2px);
    }
    
    .gallery-thumbnail {
      width: 100%;
      height: 150px;
      min-height: 150px;
      object-fit: cover;
      border-radius: 4px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      display: block;
    }
    
    .gallery-thumbnail.loading {
      opacity: 0.5;
      background: var(--input-bg);
    }
    
    .gallery-info {
      margin-top: 0.5rem;
      text-align: center;
      width: 100%;
    }
    
    .gallery-filename {
      font-size: 0.75em;
      color: var(--text);
      word-break: break-word;
      font-weight: 500;
    }
    
    .gallery-subfolder {
      font-size: 0.65em;
      color: #999;
      margin-top: 0.25rem;
      font-style: italic;
    }

    .progress { height: 12px; background: var(--input-bg); border-radius: 6px; }
    .progress-bar { background: var(--success); }

    .status-label {
      font-size: 0.85em;
      color: #999;
      margin-top: 0.25rem;
    }

    /* Console Output */
    .console-output {
      background: #000;
      border: 1px solid #444;
      border-radius: 8px;
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 0.8em;
      padding: 0.75rem;
      height: 300px;
      overflow-y: auto;
      margin-top: 1rem;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .console-output .error { color: #ff6b6b; }
    .console-output .success { color: #51cf66; }
    .console-output .info { color: #339af0; }
    .console-output .warning { color: #ffd43b; }

    .input-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .input-row label {
      min-width: 150px;
      margin-bottom: 0;
    }

    .input-row input, .input-row select {
      flex: 1;
    }

    .btn-row {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .products-display {
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 0.5rem;
    }

    .product-item {
      padding: 0.25rem 0;
      color: var(--text);
    }

    /* Modal/Popup Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .modal-header {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .script-display {
      background: #000;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      color: #0f0;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-bottom: 1rem;
    }

    .script-display.truncated::after {
      content: '\n\n... (script continues - use Copy Script to get full version)';
      color: #999;
    }

    .modal-buttons {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .modal-buttons .btn {
      min-width: 140px;
    }

    /* Gallery Styles */
    .gallery-modal {
      max-width: 98vw;
      width: 98vw;
      max-height: 95vh;
    }

    .gallery-header {
      border-bottom: 1px solid #222638;
      padding-bottom: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .gallery-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: #fff;
    }

    .gallery-subtitle {
      color: #adb5ff;
      font-size: 0.9rem;
      margin-top: 0.25rem;
    }

    .gallery-instruction {
      color: #ff6b6b;
      font-size: 0.9rem;
      min-height: 1.2rem;
      margin-bottom: 0.25rem;
    }

    .gallery-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .gallery-toolbar-left,
    .gallery-toolbar-right {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .gallery-grid {
      display: flex;
      flex-direction: column;
      gap: 0.35rem; /* Further reduced gap to fit 2 rows without scrollbar */
      max-height: calc(100vh - 320px); /* Adjusted to fit 2 rows without scrollbar */
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    .variant-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .gallery-group {
      border: 1px solid #1f2233;
      border-radius: 12px;
      padding: 0.4rem 0.6rem 0.4rem; /* Reduced padding to save vertical space */
      background: #111321;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      margin-bottom: 0; /* Remove margin-bottom, gap handles spacing */
    }

    .gallery-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.35rem; /* Reduced margin to save space */
    }

    .gallery-group-header h5 {
      margin: 0;
      font-size: 1rem;
      color: #fff;
      margin-right: auto;
    }

    .gallery-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-left: auto;
    }

    .skip-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #ff6b6b;
      filter: hue-rotate(0deg) saturate(1.2);
      appearance: none;
      -webkit-appearance: none;
      border: 2px solid #ff6b6b;
      border-radius: 3px;
      background-color: transparent;
      position: relative;
    }
    
    .skip-checkbox:checked {
      background-color: #ff6b6b;
    }
    
    .skip-checkbox:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .refresh-btn {
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      padding: 0.4rem 0.6rem;
      cursor: pointer;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      transition: all 0.2s ease;
    }

    .refresh-btn:hover {
      background: #333;
      border-color: var(--primary);
    }

    .refresh-btn:active {
      transform: scale(0.95);
    }

    .refresh-btn.loading {
      opacity: 0.6;
      cursor: not-allowed;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .gallery-group.skipped {
      opacity: 0.5;
      background: rgba(255, 107, 107, 0.1);
      border-color: rgba(255, 107, 107, 0.5);
    }

    .gallery-group.skipped .gallery-group-header h5 {
      text-decoration: line-through;
      color: #999;
    }

    .new-images-badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: var(--success);
      color: white;
      font-size: 0.7rem;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-weight: bold;
      z-index: 5;
    }

    .gallery-card.new-image {
      position: relative;
    }

    .gallery-item-id {
      color: #9aa4d3;
      font-size: 0.8rem;
      display: inline-block;
      margin-top: 0.15rem;
    }

    .gallery-card {
      background: #080b14;
      border: 1px solid #242b44;
      border-radius: 12px;
      padding: 0.5rem; /* Reduced padding to ensure halo visibility */
      width: 200px; /* Slightly reduced to ensure full halo visibility with margin */
      min-width: 200px;
      max-width: 200px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 0.35rem; /* Reduced gap between card elements */
      cursor: pointer;
      transition: border 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
      margin: 3px; /* Add margin to ensure halo is fully visible */
    }

    .url-positions-fixed {
      background: rgba(40, 167, 69, 0.15); /* Light green background around positions 1-2 */
      border: 2px solid #28a745; /* Bright green border matching Download Selected Items button */
      border-radius: 12px;
      padding: 8px;
      margin-bottom: 12px;
    }

    .gallery-card.url-position-card {
      /* Keep same styling as regular gallery cards */
      background: #080b14;
      border: 1px solid #242b44;
    }

    .gallery-card.url-position-card:hover {
      border-color: #3a3f5a;
      box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
    }

    .gallery-card-image {
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      height: 110px; /* Reduced to fit better with smaller card */
    }

    .gallery-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-card-body {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem; /* Slightly reduced font size */
    }

    .gallery-card-title {
      font-weight: 600;
      color: #fff;
      white-space: nowrap; /* Force Variant X to stay on one line */
      overflow: hidden;
      text-overflow: ellipsis; /* Show ellipsis if text is too long */
    }

    .gallery-card-source {
      color: #9aa4d3;
      font-size: 0.7rem; /* Slightly reduced font size */
      text-align: right;
      word-break: break-word; /* Allow URL text to wrap multiple lines */
    }

    .gallery-preview-btn {
      border: 1px solid #3f4b6b;
      border-radius: 999px;
      padding: 0.2rem 0.8rem;
      font-size: 0.75rem;
      background: transparent;
      color: #fff;
      align-self: flex-start;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .gallery-preview-btn:hover {
      background: #3f4b6b;
    }

    .gallery-card.selected {
      border-color: #2f9e44;
      box-shadow: 0 0 0 3px rgba(47, 158, 68, 0.5); /* Increased halo visibility */
      transform: translateY(-2px);
      margin: 3px; /* Ensure margin is maintained when selected */
    }

    /* URL Row Container Styles */
    .url-row-container {
      margin-bottom: 1.5rem;
    }

    .url-row-container:last-child {
      margin-bottom: 0;
    }

    .url-row-label {
      font-size: 0.85em;
      color: #9aa4d3;
      font-weight: 600;
      margin-bottom: 0.5rem;
      padding-left: 0.25rem;
    }

    /* Placeholder Styles - Option 5: Clean X with Gradient */
    .placeholder-x {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
      border: 2px dashed #dc3545;
      color: #dc3545;
    }

    .placeholder-x .x-icon {
      font-size: 4em;
      font-weight: bold;
      line-height: 1;
      margin-bottom: 0.5rem;
      opacity: 0.7;
    }

    .placeholder-x .x-text {
      font-size: 0.75em;
      color: #bbbbbb;
      text-align: center;
      padding: 0 0.5rem;
    }

    .variant-slider {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .slider-viewport {
      overflow: hidden;
      flex: 1;
    }

    .slider-track {
      display: flex;
      gap: 0.5rem; /* Reduced gap between cards in slider */
      transition: transform 0.3s ease;
      width: max-content; /* Ensure track is wide enough for all cards */
    }

    .slider-nav-btn {
      background: transparent;
      border: 1px solid #3f4b6b;
      color: #fff;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1rem;
    }

    .variant-slider.no-nav .slider-nav-btn {
      visibility: hidden;
    }

    .gallery-warning {
      background: rgba(230, 119, 0, 0.15);
      border: 1px solid var(--orange);
      border-radius: 8px;
      padding: 0.75rem;
      color: #ffc078;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .hidden-warning {
      display: none;
    }

    .gallery-empty {
      font-size: 0.85rem;
      color: #bbb;
      border: 1px dashed #444;
      border-radius: 8px;
      padding: 0.5rem;
      text-align: center;
    }

    .gallery-footer-status {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #bbb;
      min-height: 1.2em;
    }

    .carousel-modal {
      max-width: 900px;
      width: 95%;
      max-height: 90vh; /* Increased from default to accommodate content below image */
    }

    .carousel-body {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem; /* Add space between image and caption */
    }

    .carousel-image {
      flex: 1;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      height: 500px; /* Increased from 420px to give more space */
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .carousel-image img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .carousel-nav-btn {
      background: transparent;
      border: 1px solid #3f4b6b;
      color: #fff;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.1rem;
    }

    .carousel-caption {
      background: #1a1d2e; /* Grey background section */
      border-radius: 8px;
      padding: 1rem 1.25rem; /* Generous padding */
      margin-top: 1rem; /* Space above the grey section */
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      color: #fff; /* Ensure text is visible */
      border: 1px solid #242b44; /* Subtle border */
    }

    .carousel-caption a {
      color: #66d9ff;
      text-decoration: underline;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="main-card">
    <h2>To Do List v0.0.1</h2>

    <!-- ============================================================================= -->
    <!-- AUTHENTICATION SECTION -->
    <!-- ============================================================================= -->
    <div class="section-frame" id="authSection">
      <div class="section-title">Authentication</div>
      
      <div class="input-row">
        <label class="form-label">Organization:</label>
        <input type="text" id="orgInput" class="form-control" placeholder="Enter Organization" />
        <button id="authBtn" class="btn btn-primary" type="button">Authenticate</button>
      </div>
      
      <div id="authStatus" class="status-label" style="margin-top: 0.5rem;"></div>
      <div id="authError" class="status-label" style="margin-top: 0.5rem; color: var(--red-text); display: none;"></div>
    </div>

    <!-- ============================================================================= -->
    <!-- MAIN CONTENT (Hidden until authenticated) -->
    <!-- ============================================================================= -->
    <div id="mainContent" style="display: none;">
      <div class="section-frame">
        <div class="section-title">Welcome</div>
        <p>You are successfully authenticated!</p>
      </div>
    </div>
  </div>

  <script>
    const APP_VERSION = 'v0.0.1';
    
    // Authentication state
    let sessionOrg = null; // ORG stored in session (resets on refresh)
    let sessionToken = null; // Token stored in session (resets on refresh)
    let isAuthenticated = false; // Track authentication status
    // Simple console logging function
    function logToConsole(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = `[${timestamp}]`;
      console.log(`${prefix} ${message}`);
    }

    // API call function
    async function apiCall(endpoint, data) {
      try {
        logToConsole(`[API] Calling ${endpoint}...`, 'info');
        const url = `/api/${endpoint}`;
        const requestOptions = {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        };
        const response = await fetch(url, requestOptions);
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        const result = await response.json();
        if (result.success) {
          logToConsole(`[API] ${endpoint} succeeded`, 'success');
        } else {
          logToConsole(`[API] ${endpoint} failed: ${result.error}`, 'error');
        }
        return result;
      } catch (error) {
        logToConsole(`[API] ${endpoint} exception: ${error.message}`, 'error');
        return { success: false, error: error.message };
      }
    }

    // Update UI based on authentication status
    function updateAuthUI() {
      const authSection = document.getElementById('authSection');
      const mainContent = document.getElementById('mainContent');
      const authStatus = document.getElementById('authStatus');
      const authError = document.getElementById('authError');
      const orgInput = document.getElementById('orgInput');
      const authBtn = document.getElementById('authBtn');

      if (isAuthenticated) {
        // Hide auth section, show main content
        if (authSection) authSection.style.display = 'none';
        if (mainContent) mainContent.style.display = 'block';
        if (authStatus) authStatus.textContent = `Authenticated as: ${sessionOrg}`;
        if (authError) authError.style.display = 'none';
      } else {
        // Show auth section, hide main content
        if (authSection) authSection.style.display = 'block';
        if (mainContent) mainContent.style.display = 'none';
        if (authStatus) authStatus.textContent = '';
        if (authError) authError.style.display = 'none';
        if (orgInput) orgInput.disabled = false;
        if (authBtn) authBtn.disabled = false;
      }
    }

    // Handle authentication
    async function authenticate(org) {
      if (!org || !org.trim()) {
        const authError = document.getElementById('authError');
        if (authError) {
          authError.textContent = 'Please enter an Organization';
          authError.style.display = 'block';
        }
        return false;
      }

      const orgInput = document.getElementById('orgInput');
      const authBtn = document.getElementById('authBtn');
      const authStatus = document.getElementById('authStatus');
      const authError = document.getElementById('authError');

      // Disable inputs during authentication
      if (orgInput) orgInput.disabled = true;
      if (authBtn) authBtn.disabled = true;
      if (authStatus) authStatus.textContent = 'Authenticating...';
      if (authError) authError.style.display = 'none';

      try {
        const result = await apiCall('auth', { org: org.trim() });
        
        if (result.success) {
          sessionOrg = org.trim();
          sessionToken = result.token;
          isAuthenticated = true;
          logToConsole(`Authentication successful for ORG: ${sessionOrg}`, 'success');
          updateAuthUI();
          return true;
        } else {
          isAuthenticated = false;
          sessionOrg = null;
          sessionToken = null;
          const errorMsg = result.error || 'Authentication failed';
          logToConsole(`Authentication failed: ${errorMsg}`, 'error');
          if (authError) {
            authError.textContent = errorMsg;
            authError.style.display = 'block';
          }
          if (authStatus) authStatus.textContent = '';
          updateAuthUI();
          return false;
        }
      } catch (error) {
        isAuthenticated = false;
        sessionOrg = null;
        sessionToken = null;
        logToConsole(`Authentication error: ${error.message}`, 'error');
        if (authError) {
          authError.textContent = `Error: ${error.message}`;
          authError.style.display = 'block';
        }
        if (authStatus) authStatus.textContent = '';
        updateAuthUI();
        return false;
      } finally {
        if (orgInput) orgInput.disabled = false;
        if (authBtn) authBtn.disabled = false;
      }
    }

    // Register event handlers
    function registerEventHandlers() {
      const authBtn = document.getElementById('authBtn');
      const orgInput = document.getElementById('orgInput');

      if (authBtn) {
        authBtn.addEventListener('click', async () => {
          const org = orgInput ? orgInput.value : '';
          await authenticate(org);
        });
      }

      if (orgInput) {
        orgInput.addEventListener('keypress', async (e) => {
          if (e.key === 'Enter') {
            await authenticate(orgInput.value);
          }
        });
      }
    }

    // All unused functions removed - keeping only authentication code

    window.addEventListener('DOMContentLoaded', () => {
      logToConsole(`To Do List ${APP_VERSION} initialized`, 'success');
      
      // Register event handlers
      registerEventHandlers();
      
      // Initialize UI state
      updateAuthUI();
      
      // Check for Organization parameter in URL and auto-authenticate
      const urlParams = new URLSearchParams(window.location.search);
      const urlOrg = urlParams.get('Organization');
      
      if (urlOrg && urlOrg.trim()) {
        logToConsole(`Organization parameter detected in URL: ${urlOrg.trim()}. Auto-authenticating...`, 'info');
        
        // Populate the input field
        const orgInput = document.getElementById('orgInput');
        if (orgInput) {
          orgInput.value = urlOrg.trim();
        }
        
        // Auto-authenticate
        authenticate(urlOrg.trim()).then(success => {
          if (success) {
            logToConsole(`Auto-authentication successful for Organization: ${sessionOrg}`, 'success');
          } else {
            logToConsole(`Auto-authentication failed for Organization: ${urlOrg.trim()}`, 'error');
            const authError = document.getElementById('authError');
            if (authError) {
              authError.style.display = 'block';
            }
          }
        });
      }
    });
  </script>
</body>
</html>
