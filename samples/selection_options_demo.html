<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Selection Options Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #1a1d2e;
            color: #e0e4f0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #6c7ae0;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            color: #9aa4d3;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .option-section {
            background: #252940;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid #3a3f5a;
        }

        .option-title {
            color: #6c7ae0;
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-badge {
            background: #6c7ae0;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .option-description {
            color: #9aa4d3;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .gallery-demo {
            background: #1e2134;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #3a3f5a;
        }

        .item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e0e4f0;
        }

        .status-indicator {
            font-size: 0.85rem;
            color: #9aa4d3;
            padding: 5px 12px;
            background: #2a2d42;
            border-radius: 6px;
        }

        .status-indicator.active {
            background: #6c7ae0;
            color: white;
        }

        .image-row {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
            scrollbar-color: #3a3f5a #1e2134;
        }

        .image-row::-webkit-scrollbar {
            height: 8px;
        }

        .image-row::-webkit-scrollbar-track {
            background: #1e2134;
        }

        .image-row::-webkit-scrollbar-thumb {
            background: #3a3f5a;
            border-radius: 4px;
        }

        .image-card {
            position: relative;
            min-width: 180px;
            width: 180px;
            height: 180px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            background: #2a2d42;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .image-card:hover {
            border-color: #6c7ae0;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 122, 224, 0.3);
        }

        .image-card.selected {
            border-color: #4ade80;
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.3);
        }

        .image-card.replacing {
            border-color: #fbbf24;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(251, 191, 36, 0.5);
            }
        }

        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .position-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 2;
        }

        .position-badge.url1 {
            background: #3b82f6;
        }

        .position-badge.url2 {
            background: #8b5cf6;
        }

        .selection-summary {
            margin-top: 15px;
            padding: 12px;
            background: #2a2d42;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #9aa4d3;
        }

        .selection-summary strong {
            color: #e0e4f0;
        }

        .popup-menu {
            position: fixed;
            background: #252940;
            border: 1px solid #3a3f5a;
            border-radius: 8px;
            padding: 8px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .popup-menu.show {
            display: block;
        }

        .popup-menu button {
            display: block;
            width: 100%;
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: #e0e4f0;
            text-align: left;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .popup-menu button:hover {
            background: #3a3f5a;
        }

        .popup-menu button:not(:last-child) {
            margin-bottom: 4px;
        }

        .mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .mode-btn {
            padding: 8px 16px;
            background: #2a2d42;
            border: 1px solid #3a3f5a;
            color: #9aa4d3;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background: #6c7ae0;
            border-color: #6c7ae0;
            color: white;
        }

        .mode-btn:hover:not(.active) {
            border-color: #6c7ae0;
            color: #6c7ae0;
        }

        .drag-over {
            border-color: #4ade80 !important;
            background: rgba(74, 222, 128, 0.1) !important;
        }

        .instructions {
            background: #2a2d42;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #9aa4d3;
            border-left: 3px solid #6c7ae0;
        }

        .reset-btn {
            padding: 6px 12px;
            background: #3a3f5a;
            border: 1px solid #4a5568;
            color: #9aa4d3;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            background: #4a5568;
            color: #e0e4f0;
        }

        .selected-badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(74, 222, 128, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 3;
        }

        .not-selected {
            opacity: 0.5;
            border-color: #3a3f5a !important;
        }

        .behavior-note {
            background: #2a2d42;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #9aa4d3;
            border-left: 3px solid #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Selection Options Demo</h1>
        <p class="subtitle">Interactive demonstrations of different selection methods for replacing URL1 and URL2 images</p>

        <!-- Option 1: Click-to-Replace with Visual Mode Indicator -->
        <div class="option-section">
            <div class="option-title">
                <span>Option 1: Click-to-Replace with Visual Mode</span>
                <span class="option-badge">RECOMMENDED</span>
            </div>
            <p class="option-description">
                Click on URL1 or URL2 position to enter "replace mode" for that position. The active position will pulse. 
                Then click any image to replace it. Click the same position again or press Escape to cancel.
            </p>
            <div class="behavior-note">
                <strong>Behavior:</strong> Old image disappears/removed when replaced (Option A)
            </div>
            <div class="gallery-demo" id="demo1">
                <div class="item-header">
                    <div class="item-title">Item: DEMO-001</div>
                    <div class="status-indicator" id="status1">Ready - Click URL1 or URL2 to replace</div>
                    <button class="reset-btn" onclick="resetDemo(1)">Reset</button>
                </div>
                <div class="image-row">
                    <div class="image-card url1-card" data-position="url1" onclick="handleOption1Click('url1', this)">
                        <span class="position-badge url1">URL1</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                    <div class="image-card url2-card" data-position="url2" onclick="handleOption1Click('url2', this)">
                        <span class="position-badge url2">URL2</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img1" data-gradient="#4facfe,#00f2fe" onclick="handleOption1Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img2" data-gradient="#43e97b,#38f9d7" onclick="handleOption1Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img3" data-gradient="#fa709a,#fee140" onclick="handleOption1Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img4" data-gradient="#30cfd0,#330867" onclick="handleOption1Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
                    </div>
                </div>
                <div class="selection-summary" id="summary1">
                    <strong>Selected:</strong> URL1: Original | URL2: Original
                </div>
            </div>
        </div>

        <!-- Option 2: Two-Button Selection -->
        <div class="option-section">
            <div class="option-title">
                <span>Option 2: Two-Button Selection</span>
            </div>
            <p class="option-description">
                Click any image to see a popup menu with "Replace URL1" and "Replace URL2" options. Choose which position to replace.
            </p>
            <div class="behavior-note">
                <strong>Behavior:</strong> Old image moves to Google images section when replaced (Option B)
            </div>
            <div class="gallery-demo" id="demo2">
                <div class="item-header">
                    <div class="item-title">Item: DEMO-002</div>
                    <button class="reset-btn" onclick="resetDemo(2)">Reset</button>
                </div>
                <div class="image-row">
                    <div class="image-card url1-card" data-position="url1">
                        <span class="position-badge url1">URL1</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                    <div class="image-card url2-card" data-position="url2">
                        <span class="position-badge url2">URL2</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img1" data-gradient="#4facfe,#00f2fe" onclick="handleOption2Click(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img2" data-gradient="#43e97b,#38f9d7" onclick="handleOption2Click(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img3" data-gradient="#fa709a,#fee140" onclick="handleOption2Click(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img4" data-gradient="#30cfd0,#330867" onclick="handleOption2Click(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
                    </div>
                </div>
                <div class="popup-menu" id="popup2">
                    <button onclick="handleOption2Replace('url1')">Replace URL1</button>
                    <button onclick="handleOption2Replace('url2')">Replace URL2</button>
                    <button onclick="closePopup(2)">Cancel</button>
                </div>
                <div class="selection-summary" id="summary2">
                    <strong>Selected:</strong> URL1: Original | URL2: Original
                </div>
            </div>
        </div>

        <!-- Option 3: Drag and Drop -->
        <div class="option-section">
            <div class="option-title">
                <span>Option 3: Drag and Drop</span>
            </div>
            <p class="option-description">
                Drag any image and drop it onto the URL1 or URL2 position to replace it. The drop target will highlight when you drag over it.
            </p>
            <div class="behavior-note">
                <strong>Behavior:</strong> Images swap positions when replaced (Option C)
            </div>
            <div class="gallery-demo" id="demo3">
                <div class="item-header">
                    <div class="item-title">Item: DEMO-003</div>
                    <button class="reset-btn" onclick="resetDemo(3)">Reset</button>
                </div>
                <div class="image-row">
                    <div class="image-card url1-card" data-position="url1" 
                         ondrop="handleOption3Drop(event, 'url1')" 
                         ondragover="handleOption3DragOver(event)" 
                         ondragleave="handleOption3DragLeave(event)">
                        <span class="position-badge url1">URL1</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                    <div class="image-card url2-card" data-position="url2"
                         ondrop="handleOption3Drop(event, 'url2')" 
                         ondragover="handleOption3DragOver(event)" 
                         ondragleave="handleOption3DragLeave(event)">
                        <span class="position-badge url2">URL2</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img1" data-gradient="#4facfe,#00f2fe" draggable="true" ondragstart="handleOption3DragStart(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img2" data-gradient="#43e97b,#38f9d7" draggable="true" ondragstart="handleOption3DragStart(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img3" data-gradient="#fa709a,#fee140" draggable="true" ondragstart="handleOption3DragStart(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img4" data-gradient="#30cfd0,#330867" draggable="true" ondragstart="handleOption3DragStart(event, this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
                    </div>
                </div>
                <div class="selection-summary" id="summary3">
                    <strong>Selected:</strong> URL1: Original | URL2: Original
                </div>
            </div>
        </div>

        <!-- Option 4: Right-Click Context Menu -->
        <div class="option-section">
            <div class="option-title">
                <span>Option 4: Right-Click Context Menu</span>
            </div>
            <p class="option-description">
                <strong>How to use:</strong> Right-click (or long-press on mobile) on any image card to see a context menu. 
                Right-click on URL1/URL2 positions shows "Replace this image". Right-click on Google images shows "Use for URL1" and "Use for URL2" options.
            </p>
            <div class="behavior-note">
                <strong>Behavior:</strong> Old image stays in place but marked as not selected (Option D) - The replaced image becomes dimmed (50% opacity) and loses its badge.
            </div>
            <div class="gallery-demo" id="demo4">
                <div class="item-header">
                    <div class="item-title">Item: DEMO-004</div>
                    <button class="reset-btn" onclick="resetDemo(4)">Reset</button>
                </div>
                <div class="image-row">
                    <div class="image-card url1-card" data-position="url1" oncontextmenu="handleOption4Context(event, 'url1', this); return false;">
                        <span class="position-badge url1">URL1</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                    <div class="image-card url2-card" data-position="url2" oncontextmenu="handleOption4Context(event, 'url2', this); return false;">
                        <span class="position-badge url2">URL2</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img1" data-gradient="#4facfe,#00f2fe" oncontextmenu="handleOption4Context(event, 'image', this); return false;">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img2" data-gradient="#43e97b,#38f9d7" oncontextmenu="handleOption4Context(event, 'image', this); return false;">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img3" data-gradient="#fa709a,#fee140" oncontextmenu="handleOption4Context(event, 'image', this); return false;">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img4" data-gradient="#30cfd0,#330867" oncontextmenu="handleOption4Context(event, 'image', this); return false;">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
                    </div>
                </div>
                <div class="popup-menu" id="popup4"></div>
                <div class="selection-summary" id="summary4">
                    <strong>Selected:</strong> URL1: Original | URL2: Original
                </div>
            </div>
        </div>

        <!-- Option 5: Toggle Mode Buttons -->
        <div class="option-section">
            <div class="option-title">
                <span>Option 5: Toggle Mode Buttons</span>
            </div>
            <p class="option-description">
                Use the toggle buttons to select which position you want to replace (URL1 or URL2). The active mode is highlighted. Then click any image to replace that position.
            </p>
            <div class="behavior-note">
                <strong>Behavior:</strong> Old image disappears/removed when replaced (Option A)
            </div>
            <div class="gallery-demo" id="demo5">
                <div class="item-header">
                    <div class="item-title">Item: DEMO-005</div>
                    <button class="reset-btn" onclick="resetDemo(5)">Reset</button>
                </div>
                <div class="mode-toggle">
                    <button class="mode-btn active" id="mode-url1" onclick="setReplaceMode('url1')">Replace URL1</button>
                    <button class="mode-btn" id="mode-url2" onclick="setReplaceMode('url2')">Replace URL2</button>
                </div>
                <div class="instructions" id="instructions5">
                    Mode: <strong>Replace URL1</strong> - Click any image below to replace URL1
                </div>
                <div class="image-row">
                    <div class="image-card url1-card" data-position="url1">
                        <span class="position-badge url1">URL1</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                    <div class="image-card url2-card" data-position="url2">
                        <span class="position-badge url2">URL2</span>
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img1" data-gradient="#4facfe,#00f2fe" onclick="handleOption5Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img2" data-gradient="#43e97b,#38f9d7" onclick="handleOption5Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img3" data-gradient="#fa709a,#fee140" onclick="handleOption5Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
                    </div>
                    <div class="image-card" data-image="img4" data-gradient="#30cfd0,#330867" onclick="handleOption5Replace(this)">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
                    </div>
                </div>
                <div class="selection-summary" id="summary5">
                    <strong>Selected:</strong> URL1: Original | URL2: Original
                </div>
            </div>
        </div>
    </div>

    <script>
        // Image data storage
        const imageData = {
            'original-url1': { gradient: '#667eea,#764ba2', name: 'Original URL1' },
            'original-url2': { gradient: '#f093fb,#f5576c', name: 'Original URL2' },
            'img1': { gradient: '#4facfe,#00f2fe', name: 'Blue Gradient' },
            'img2': { gradient: '#43e97b,#38f9d7', name: 'Green Gradient' },
            'img3': { gradient: '#fa709a,#fee140', name: 'Pink-Yellow Gradient' },
            'img4': { gradient: '#30cfd0,#330867', name: 'Cyan-Purple Gradient' }
        };

        // Demo state - store actual image IDs and original positions
        const demoState = {
            1: { replacing: null, url1: 'original-url1', url2: 'original-url2', originalUrl1: 'original-url1', originalUrl2: 'original-url2' },
            2: { url1: 'original-url1', url2: 'original-url2', clickedImage: null, originalUrl1: 'original-url1', originalUrl2: 'original-url2' },
            3: { url1: 'original-url1', url2: 'original-url2', draggedImage: null, originalUrl1: 'original-url1', originalUrl2: 'original-url2' },
            4: { url1: 'original-url1', url2: 'original-url2', originalUrl1: 'original-url1', originalUrl2: 'original-url2' },
            5: { mode: 'url1', url1: 'original-url1', url2: 'original-url2', originalUrl1: 'original-url1', originalUrl2: 'original-url2' }
        };

        // Helper function to get gradient colors
        function getGradient(imageId) {
            const data = imageData[imageId];
            if (!data) return '#667eea,#764ba2';
            return data.gradient;
        }

        // Helper function to render image card
        function renderImageCard(imageId, position = null, showBadge = false) {
            const colors = getGradient(imageId).split(',');
            const badge = position ? `<span class="position-badge ${position}">${position.toUpperCase()}</span>` : '';
            const selectedBadge = showBadge ? `<span class="selected-badge">${position ? position.toUpperCase() : 'SELECTED'}</span>` : '';
            return `${badge}${selectedBadge}<div style="width: 100%; height: 100%; background: linear-gradient(135deg, ${colors[0]} 0%, ${colors[1]} 100%);"></div>`;
        }

        // Option 1: Click-to-Replace - Behavior A: Old image disappears
        function handleOption1Click(position, element) {
            const state = demoState[1];
            if (state.replacing === position) {
                // Cancel mode
                state.replacing = null;
                element.classList.remove('replacing');
                document.getElementById('status1').textContent = 'Ready - Click URL1 or URL2 to replace';
                document.getElementById('status1').classList.remove('active');
            } else {
                // Enter replace mode
                state.replacing = position;
                document.querySelectorAll('#demo1 .image-card').forEach(card => {
                    card.classList.remove('replacing');
                });
                element.classList.add('replacing');
                document.getElementById('status1').textContent = `Replacing ${position.toUpperCase()} - Click an image to replace`;
                document.getElementById('status1').classList.add('active');
            }
        }

        function handleOption1Replace(element) {
            const state = demoState[1];
            if (!state.replacing) return;
            
            const imageId = element.dataset.image;
            const oldImageId = state[state.replacing];
            state[state.replacing] = imageId;
            
            // Update URL1/URL2 position with new image
            const urlCard = document.querySelector(`#demo1 .${state.replacing}-card`);
            urlCard.innerHTML = renderImageCard(imageId, state.replacing);
            
            // Behavior A: Remove old image from gallery (if it was a Google image)
            if (oldImageId && oldImageId !== 'original-url1' && oldImageId !== 'original-url2') {
                const oldCard = document.querySelector(`#demo1 .image-card[data-image="${oldImageId}"]`);
                if (oldCard) {
                    oldCard.remove();
                }
            }
            
            // Add selected badge to the new image if it's still in gallery
            const newCard = document.querySelector(`#demo1 .image-card[data-image="${imageId}"]`);
            if (newCard && imageId !== 'original-url1' && imageId !== 'original-url2') {
                newCard.innerHTML = `<span class="selected-badge">${state.replacing.toUpperCase()}</span>${newCard.querySelector('div').outerHTML}`;
            }
            
            // Reset mode
            state.replacing = null;
            urlCard.classList.remove('replacing');
            document.getElementById('status1').textContent = 'Ready - Click URL1 or URL2 to replace';
            document.getElementById('status1').classList.remove('active');
            
            updateSummary(1);
        }

        // Option 2: Two-Button Selection - Behavior B: Old image moves to Google images section
        let currentClickedImage = null;

        function handleOption2Click(event, element) {
            event.stopPropagation();
            currentClickedImage = element;
            const popup = document.getElementById('popup2');
            const rect = element.getBoundingClientRect();
            popup.style.left = rect.right + 'px';
            popup.style.top = rect.top + 'px';
            popup.classList.add('show');
        }

        function handleOption2Replace(position) {
            const state = demoState[2];
            if (!currentClickedImage) return;
            
            const imageId = currentClickedImage.dataset.image;
            const oldImageId = state[position];
            state[position] = imageId;
            
            // Update URL1/URL2 position with new image
            const urlCard = document.querySelector(`#demo2 .${position}-card`);
            urlCard.innerHTML = renderImageCard(imageId, position);
            
            // Behavior B: Move old image to Google images section (if it was original)
            if (oldImageId === 'original-url1' || oldImageId === 'original-url2') {
                const imageRow = document.querySelector('#demo2 .image-row');
                const newCard = document.createElement('div');
                newCard.className = 'image-card';
                newCard.dataset.image = oldImageId;
                newCard.dataset.gradient = getGradient(oldImageId);
                newCard.onclick = (e) => handleOption2Click(e, newCard);
                newCard.innerHTML = `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, ${getGradient(oldImageId).split(',')[0]} 0%, ${getGradient(oldImageId).split(',')[1]} 100%);"></div>`;
                imageRow.appendChild(newCard);
            }
            
            // Add selected badge to the new image
            if (currentClickedImage) {
                currentClickedImage.innerHTML = `<span class="selected-badge">${position.toUpperCase()}</span>${currentClickedImage.querySelector('div').outerHTML}`;
            }
            
            closePopup(2);
            updateSummary(2);
        }

        function closePopup(demoNum) {
            document.getElementById(`popup${demoNum}`).classList.remove('show');
            currentClickedImage = null;
        }

        // Option 3: Drag and Drop - Behavior C: Images swap positions
        function handleOption3DragStart(event, element) {
            demoState[3].draggedImage = element;
            event.dataTransfer.effectAllowed = 'move';
        }

        function handleOption3DragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            event.currentTarget.classList.add('drag-over');
        }

        function handleOption3DragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function handleOption3Drop(event, position) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const state = demoState[3];
            if (!state.draggedImage) return;
            
            const imageId = state.draggedImage.dataset.image;
            const oldImageId = state[position];
            state[position] = imageId;
            
            // Update URL1/URL2 position with new image
            const urlCard = document.querySelector(`#demo3 .${position}-card`);
            urlCard.innerHTML = renderImageCard(imageId, position);
            
            // Behavior C: Swap - old image moves to where dragged image was
            if (state.draggedImage && oldImageId) {
                const oldColors = getGradient(oldImageId).split(',');
                state.draggedImage.innerHTML = `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, ${oldColors[0]} 0%, ${oldColors[1]} 100%);"></div>`;
                state.draggedImage.dataset.image = oldImageId;
            }
            
            // Add selected badge to the new image in URL position
            urlCard.innerHTML += `<span class="selected-badge">SELECTED</span>`;
            
            state.draggedImage = null;
            updateSummary(3);
        }

        // Option 4: Right-Click Context Menu - Behavior D: Old image stays but marked as not selected
        function handleOption4Context(event, type, element) {
            event.preventDefault();
            event.stopPropagation();
            
            const popup = document.getElementById('popup4');
            if (!popup) {
                console.error('Popup element not found!');
                return;
            }
            
            popup.innerHTML = '';
            
            if (type === 'url1' || type === 'url2') {
                const btn = document.createElement('button');
                btn.textContent = 'Replace this image';
                btn.onclick = () => {
                    // Show all available images for selection
                    const imageRow = document.querySelector('#demo4 .image-row');
                    const availableImages = Array.from(imageRow.querySelectorAll('.image-card[data-image]'));
                    if (availableImages.length > 0) {
                        // For demo, just use first available image
                        const firstImage = availableImages[0];
                        handleOption4Replace(type, firstImage);
                    }
                    closePopup(4);
                };
                popup.appendChild(btn);
            } else {
                const btn1 = document.createElement('button');
                btn1.textContent = 'Use for URL1';
                btn1.onclick = () => {
                    handleOption4Replace('url1', element);
                    closePopup(4);
                };
                const btn2 = document.createElement('button');
                btn2.textContent = 'Use for URL2';
                btn2.onclick = () => {
                    handleOption4Replace('url2', element);
                    closePopup(4);
                };
                popup.appendChild(btn1);
                popup.appendChild(btn2);
            }
            
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => closePopup(4);
            popup.appendChild(cancelBtn);
            
            // Position popup at cursor location
            const x = event.clientX || event.pageX;
            const y = event.clientY || event.pageY;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            popup.style.position = 'fixed';
            popup.style.zIndex = '10000';
            
            // Make sure popup is visible
            popup.classList.add('show');
            
            // Debug log
            console.log('Context menu opened at:', x, y, 'Type:', type);
        }

        function handleOption4Replace(position, element) {
            const state = demoState[4];
            const imageId = element.dataset.image;
            const oldImageId = state[position];
            state[position] = imageId;
            
            // Update URL1/URL2 position with new image
            const urlCard = document.querySelector(`#demo4 .${position}-card`);
            urlCard.innerHTML = renderImageCard(imageId, position);
            
            // Behavior D: Old image stays but marked as not selected
            if (oldImageId && oldImageId !== 'original-url1' && oldImageId !== 'original-url2') {
                const oldCard = document.querySelector(`#demo4 .image-card[data-image="${oldImageId}"]`);
                if (oldCard) {
                    oldCard.classList.add('not-selected');
                    // Remove any selected badges
                    const badge = oldCard.querySelector('.selected-badge');
                    if (badge) badge.remove();
                }
            }
            
            // Mark new image as selected
            if (element) {
                element.classList.remove('not-selected');
                element.innerHTML = `<span class="selected-badge">${position.toUpperCase()}</span>${element.querySelector('div').outerHTML}`;
            }
            
            updateSummary(4);
        }

        // Option 5: Toggle Mode Buttons - Behavior A: Old image disappears
        function setReplaceMode(position) {
            demoState[5].mode = position;
            document.getElementById('mode-url1').classList.toggle('active', position === 'url1');
            document.getElementById('mode-url2').classList.toggle('active', position === 'url2');
            document.getElementById('instructions5').innerHTML = 
                `Mode: <strong>Replace ${position.toUpperCase()}</strong> - Click any image below to replace ${position.toUpperCase()}`;
        }

        function handleOption5Replace(element) {
            const state = demoState[5];
            const imageId = element.dataset.image;
            const oldImageId = state[state.mode];
            state[state.mode] = imageId;
            
            // Update URL1/URL2 position with new image
            const urlCard = document.querySelector(`#demo5 .${state.mode}-card`);
            urlCard.innerHTML = renderImageCard(imageId, state.mode);
            
            // Behavior A: Remove old image from gallery (if it was a Google image)
            if (oldImageId && oldImageId !== 'original-url1' && oldImageId !== 'original-url2') {
                const oldCard = document.querySelector(`#demo5 .image-card[data-image="${oldImageId}"]`);
                if (oldCard) {
                    oldCard.remove();
                }
            }
            
            // Add selected badge to the new image if it's still in gallery
            const newCard = document.querySelector(`#demo5 .image-card[data-image="${imageId}"]`);
            if (newCard && imageId !== 'original-url1' && imageId !== 'original-url2') {
                newCard.innerHTML = `<span class="selected-badge">${state.mode.toUpperCase()}</span>${newCard.querySelector('div').outerHTML}`;
            }
            
            updateSummary(5);
        }

        // Utility functions
        function updateSummary(demoNum) {
            const state = demoState[demoNum];
            const url1Name = imageData[state.url1] ? imageData[state.url1].name : 'Original';
            const url2Name = imageData[state.url2] ? imageData[state.url2].name : 'Original';
            document.getElementById(`summary${demoNum}`).innerHTML = 
                `<strong>Selected:</strong> URL1: ${url1Name} | URL2: ${url2Name}`;
        }

        function resetDemo(demoNum) {
            const state = demoState[demoNum];
            state.url1 = state.originalUrl1;
            state.url2 = state.originalUrl2;
            
            if (demoNum === 1) {
                state.replacing = null;
                document.querySelectorAll('#demo1 .image-card').forEach(card => card.classList.remove('replacing'));
                document.getElementById('status1').textContent = 'Ready - Click URL1 or URL2 to replace';
                document.getElementById('status1').classList.remove('active');
            }
            if (demoNum === 5) {
                state.mode = 'url1';
                setReplaceMode('url1');
            }
            
            // Reset visual cards
            const url1Card = document.querySelector(`#demo${demoNum} .url1-card`);
            const url2Card = document.querySelector(`#demo${demoNum} .url2-card`);
            url1Card.innerHTML = renderImageCard('original-url1', 'url1');
            url2Card.innerHTML = renderImageCard('original-url2', 'url2');
            
            // Reset all image cards and remove badges
            document.querySelectorAll(`#demo${demoNum} .image-card`).forEach(card => {
                card.classList.remove('not-selected', 'selected');
                const badge = card.querySelector('.selected-badge');
                if (badge) badge.remove();
                const imageId = card.dataset.image;
                if (imageId && imageId !== 'original-url1' && imageId !== 'original-url2') {
                    const colors = getGradient(imageId).split(',');
                    card.innerHTML = `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, ${colors[0]} 0%, ${colors[1]} 100%);"></div>`;
                }
            });
            
            updateSummary(demoNum);
        }

        // Close popups when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.popup-menu') && !e.target.closest('.image-card[data-image]')) {
                document.querySelectorAll('.popup-menu').forEach(popup => popup.classList.remove('show'));
                currentClickedImage = null;
            }
        });

        // Close popup on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.popup-menu').forEach(popup => popup.classList.remove('show'));
                currentClickedImage = null;
            }
        });

        // Also handle contextmenu event on document to close other popups
        document.addEventListener('contextmenu', (e) => {
            // Close other popups when opening a new one
            if (!e.target.closest('#demo4')) {
                document.querySelectorAll('.popup-menu').forEach(popup => popup.classList.remove('show'));
            }
        });

        // Escape key to cancel Option 1 mode
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && demoState[1].replacing) {
                const state = demoState[1];
                const urlCard = document.querySelector(`#demo1 .${state.replacing}-card`);
                urlCard.classList.remove('replacing');
                state.replacing = null;
                document.getElementById('status1').textContent = 'Ready - Click URL1 or URL2 to replace';
                document.getElementById('status1').classList.remove('active');
            }
        });
    </script>
</body>
</html>
